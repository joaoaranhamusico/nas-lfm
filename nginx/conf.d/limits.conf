# File: /etc/nginx/conf.d/limits.conf
# Mode: SAFE-PROD-LITE v1.1.6 (session-aware; generous)
# Author: João Aranha
# Last Modified: 2025-11-05

# Tamanho de upload razoável
client_max_body_size 25m;

# Connection limiting (anti hoarding) por IP — largo o suficiente para sua carga
limit_conn_zone $binary_remote_addr zone=conn_ip:10m;
limit_req_zone $binary_remote_addr zone=req_ip:10m rate=10r/s;

# Zonas de rate por SESSÃO (fallback IP)
# Autosubmit: muito alto (10 r/s) para UX instantânea
limit_req_zone $limit_key zone=req_autosubmit:20m rate=10r/s;

# Submit: alto (6 r/s) — operações em lote rápidas
limit_req_zone $limit_key zone=req_submit:10m rate=6r/s;

# Auth (anti brute force): moderado por IP (não usa sessão aqui)
limit_req_zone $binary_remote_addr zone=req_auth:5m rate=60r/m;
